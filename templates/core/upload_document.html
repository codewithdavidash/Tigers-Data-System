{% extends 'base/base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Secure Upload | Tigers Data{% endblock title %}

{% block content %}
<div class="min-h-screen bg-[#0f172a] flex flex-col justify-center items-center px-4 relative overflow-hidden">
    
    <div class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-yellow-500/5 rounded-full blur-[120px]"></div>
    <div class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-blue-500/5 rounded-full blur-[120px]"></div>

    <div class="text-center mb-10 z-10">
        <h1 class="text-3xl md:text-4xl font-black text-white uppercase italic tracking-tighter">
            Data<span class="text-yellow-400">Ingestion</span>
        </h1>
        <p class="text-[10px] text-yellow-500/60 tracking-[0.4em] font-bold uppercase mt-2">Protocol: AES-256 Bit Encryption Active</p>
    </div>

    <div class="max-w-xl w-full bg-gray-900/40 backdrop-blur-2xl border border-white/10 rounded-3xl p-8 shadow-2xl z-10">
        <form method="POST" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-1">
                    <label for="{{ form.title.id_for_label }}" class="text-[10px] font-bold text-gray-500 uppercase tracking-widest ml-1">
                        Asset Title
                    </label>
                    {{ form.title|add_class:"w-full bg-black/20 border border-white/5 rounded-xl px-4 py-3 text-yellow-400 placeholder-gray-700 focus:outline-none focus:border-yellow-500/50 focus:ring-1 focus:ring-yellow-500/50 transition-all" }}
                    {% if form.title.errors %}
                        <p class="text-red-400 text-[10px] uppercase font-bold mt-1">{{ form.title.errors|striptags }}</p>
                    {% endif %}
                </div>

                <div class="space-y-1">
                    <label for="{{ form.doc_type.id_for_label }}" class="text-[10px] font-bold text-gray-500 uppercase tracking-widest ml-1">
                        Classification
                    </label>
                    {{ form.doc_type|add_class:"w-full bg-black/20 border border-white/5 rounded-xl px-4 py-3 text-yellow-400 placeholder-gray-700 focus:outline-none focus:border-yellow-500/50 focus:ring-1 focus:ring-yellow-500/50 transition-all" }}
                </div>
            </div>

            <div class="space-y-1">
                <label for="{{ form.description.id_for_label }}" class="text-[10px] font-bold text-gray-500 uppercase tracking-widest ml-1">
                    Meta Description (Optional)
                </label>
                {{ form.description|add_class:"w-full bg-black/20 border border-white/5 rounded-xl px-4 py-3 text-yellow-400 placeholder-gray-700 focus:outline-none focus:border-yellow-500/50 focus:ring-1 focus:ring-yellow-500/50 transition-all h-24" }}
            </div>

            <div class="space-y-2">
                <label class="text-[10px] font-bold text-gray-500 uppercase tracking-widest ml-1">Binary Payload</label>
                <div id="drop-zone" class="group relative flex flex-col items-center justify-center w-full h-40 border-2 border-dashed border-white/10 rounded-2xl bg-black/20 hover:bg-black/40 hover:border-yellow-500/50 transition-all cursor-pointer overflow-hidden">
                    
                    <div class="flex flex-col items-center justify-center space-y-2 py-6 pointer-events-none">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-yellow-500/50 group-hover:text-yellow-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 11-8 0 4 4 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                        <p class="text-xs text-gray-500 group-hover:text-gray-300 transition-colors">Drag & Drop or <span class="text-yellow-500">Browse Files</span></p>
                        <p id="file-name" class="text-[10px] font-mono text-yellow-400 mt-2 hidden"></p>
                    </div>

                    {{ form.file|add_class:"absolute inset-0 opacity-0 cursor-pointer" }}
                </div>
                {% if form.file.errors %}
                    <p class="text-red-400 text-[10px] uppercase font-bold mt-1">{{ form.file.errors|striptags }}</p>
                {% endif %}
            </div>

            <div class="pt-4">
                <button type="submit"
                        class="w-full py-4 bg-yellow-500 hover:bg-yellow-400 text-gray-900 font-black uppercase tracking-widest rounded-xl transition-all duration-300 shadow-lg shadow-yellow-500/20 hover:shadow-yellow-500/40 active:scale-[0.98]">
                    Finalize Ingestion
                </button>
            </div>
            
            <div class="text-center">
                <a href="{% url 'index' %}" class="text-[10px] font-bold text-gray-600 uppercase tracking-widest hover:text-yellow-500 transition">Return to Command Center</a>
            </div>
        </form>
    </div>
</div>

<script>
    const fileInput = document.querySelector('input[type="file"]');
    const fileNameDisplay = document.getElementById("file-name");
    const dropZone = document.getElementById("drop-zone");

    fileInput.addEventListener("change", (e) => {
        if (fileInput.files.length > 0) {
            fileNameDisplay.textContent = "PAYLOAD: " + fileInput.files[0].name;
            fileNameDisplay.classList.remove("hidden");
        }
    });

    // Simple visual feedback for drag and drop
    ['dragover', 'mouseenter'].forEach(event => {
        dropZone.addEventListener(event, () => dropZone.classList.add('bg-black/40', 'border-yellow-500/50'));
    });
    ['dragleave', 'mouseleave'].forEach(event => {
        dropZone.addEventListener(event, () => {
            if (fileInput.files.length === 0) dropZone.classList.remove('bg-black/40', 'border-yellow-500/50');
        });
    });
</script>
{% endblock content %}